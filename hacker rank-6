WITH challenge_count AS (
    SELECT hacker_id, COUNT(*) AS total
    FROM Challenges
    GROUP BY hacker_id
),
max_count AS (
    SELECT MAX(total) AS max_total
    FROM challenge_count
),
frequency_count AS (
    SELECT total, COUNT(*) AS freq
    FROM challenge_count
    GROUP BY total
)
SELECT h.hacker_id, h.name, c.total
FROM challenge_count c
JOIN Hackers h 
    ON h.hacker_id = c.hacker_id
JOIN frequency_count f
    ON c.total = f.total
JOIN max_count m
    ON 1=1
WHERE c.total = m.max_total
   OR f.freq = 1
ORDER BY c.total DESC, h.hacker_id;
